# Etapa 1: Instalar depend√™ncias e construir a aplica√ß√£o
FROM node:20 AS builder
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm install
COPY . .

# üö® CORRE√á√ÉO: Aplicar a vari√°vel NEXT_FONT_GOOGLE_OPTIMIZED=false aqui, na etapa de build.
RUN npm run build
# RUN NEXT_FONT_GOOGLE_OPTIMIZED=false npm run build
# Etapa 2: Executar a aplica√ß√£o em um ambiente leve
FROM node:20-alpine
WORKDIR /app

# Copia apenas o necess√°rio para produ√ß√£o:
# O Next.js precisa da pasta .next e dos node_modules
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/node_modules ./node_modules

# üö® CORRE√á√ÉO CR√çTICA: Copia o package.json para que o 'npm start' funcione
COPY --from=builder /app/package.json ./package.json

# üö® NOVO: Copia todo o c√≥digo fonte e arquivos de configura√ß√£o restantes do BUILDER
# O * significa "tudo que estiver na raiz de /app", garantindo que /app/src seja inclu√≠do.
COPY --from=builder /app/. .

# O Next.js usa a porta 3000 por padr√£o.
EXPOSE 3000

# Comando para iniciar o servidor Next.js em produ√ß√£o
CMD ["npm", "start"]